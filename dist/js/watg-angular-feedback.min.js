/*! watg-angular-feedback 2015-07-30 */
var feedbackModule=angular.module("feedbackModule",["ngRoute","ngSanitize"]).config(function($routeProvider,$httpProvider){$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"],$routeProvider.when("/",{templateUrl:"app/views/feedbackView.html",controller:"feedbackController"}).otherwise({redirectTo:"/"})});feedbackModule.controller("feedbackController",function($scope,feedbackService){$scope.header="Feedback",$scope.projectName="eMail Campaign App",$scope.getProjectDetailsUrl="http://itstage.watg.com/watgxapirest/api/Feedback/GetProjectDetails/",$scope.submitProjectFeedbackUrl="http://itstage.watg.com/watgxapirest/api/Feedback/AddProjectFeedback",$scope.userFullName="Tolga Koseoglu"}),feedbackModule.directive("watgFeedback",function(feedbackService){var controller=["$scope",function($scope){function updateStars(){$scope.stars=[];for(var i=0;i<$scope.max;i++)$scope.stars.push({filled:i<$scope.ratingValue})}$scope.header="Feedback",$scope.isBusySubmittingFeedback=!1,$scope.showConfirmation=!1,$scope.form={},$scope.feedbackItem={feedback:"",applicationId:0,applicationName:"",applicationDescription:"",applicationVersion:"",vendor:"",platform:"",userAgent:"",screenResolution:"",rating:null},$scope.max=5,$scope.stars=[],$scope.ratingValue=3,$scope.getProjectDetails=function(){$scope.isBusy=!0,feedbackService.getProjectDetails($scope.getUrl+"/"+$scope.projectName).then(function(result){$scope.feedbackItem.applicationId=result.Id,$scope.feedbackItem.applicationName=result.ProjectName,$scope.feedbackItem.applicationDescription=result.ProjectDescription,$scope.feedbackItem.applicationVersion=result.Version,$scope.isBusy=!1})},$scope.submitFeedback=function(){$scope.isBusySubmittingFeedback=!0,$scope.feedbackItem.vendor=navigator.vendor,$scope.feedbackItem.platform=navigator.platform,$scope.feedbackItem.userAgent=navigator.userAgent,$scope.feedbackItem.screenResolution=screen.width+"*"+screen.height,$scope.feedbackItem.rating=$scope.ratingValue,feedbackService.addProjectFeedback($scope.feedbackItem,$scope.submitUrl).then(function(result){console.log(result);$scope.showConfirmation=!0,$scope.isBusySubmittingFeedback=!1})},$scope.toggle=function(index){$scope.ratingValue=index+1},$scope.$watch("ratingValue",function(oldValue,newValue){newValue&&updateStars()}),$scope.getProjectDetails()}];return{restrict:"E",templateUrl:"app/templates/feedbackTemplate.html",scope:{projectName:"=",getUrl:"=",submitUrl:"=",userFullName:"="},controller:controller,link:function(scope,element){console.log(scope.projectName),console.log(scope.getUrl),console.log(scope.submitUrl),console.log(scope.userFullName)}}}),feedbackModule.factory("feedbackService",function($http,$log,$q,$rootScope){return{getProjectDetails:function(url){return console.log(url),$http({method:"GET",withCredentials:!0,url:url}).then(function(response){return response.data})},addProjectFeedback:function(vm,url){return console.log(vm),console.log(url),$http({method:"POST",data:$.param(vm),withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:url}).then(function(response){return response.data})}}});