/*! watg-angular-feedback 2016-11-29 */
!function(){"use strict";var modules=["ngRoute","watgFeedback.templates","watgRichtext","watgFileuploadModule"];angular.module("watgFeedbackApp",modules)}(),function(){"use strict";function watgFeedback(){return{restrict:"E",templateUrl:"src/app/directives/templates/watgFeedbackTemplate.html",scope:{projectName:"=",watgApiUrl:"=",userFullName:"=",urlReferrer:"=",logsEnabled:"=?",feedbackInputHeight:"=?",feedbackMaxNumberOfAttachments:"=?",feedbackAttachmentMaxSize:"=?",feedbackAttachmentImageMaxHeight:"=?",feedbackAttachmentImageMaxWidth:"=?"},controller:controller,link:function(scope){scope.feedbackInputHeight||(scope.feedbackInputHeight=100),scope.feedbackAttachmentMaxSize||(scope.feedbackAttachmentMaxSize=2097152),scope.feedbackAttachmentImageMaxHeight||(scope.feedbackAttachmentImageMaxHeight=1e3),scope.feedbackAttachmentImageMaxWidth||(scope.feedbackAttachmentImageMaxWidth=1e3),scope.feedbackMaxNumberOfAttachments||(scope.feedbackMaxNumberOfAttachments=5),scope.logsEnabled||(scope.logsEnabled=!0),scope.logsEnabled&&(console.log(scope.projectName),console.log(scope.watgApiUrl),console.log(scope.userFullName),console.log(scope.urlReferrer))}}}angular.module("watgFeedbackModule").directive("watgFeedback",watgFeedback);var controller=["$scope","watgFeedbackService",function($scope,watgFeedbackService){function updateStars(){$scope.stars=[];for(var i=0;i<$scope.max;i++)$scope.stars.push({filled:i<$scope.ratingValue})}var boostrapCssPath="dev/css/vendor.min.css";$scope.header="Feedback",$scope.isBusySubmittingFeedback=!1,$scope.showConfirmation=!1,$scope.form={},$scope.max=5,$scope.ratingValue=0,$scope.stars=[],$scope.feebackContentResetCount=[],$scope.projectNotFound=!1,$scope.reset=function(){$scope.appDevProjectUI={AppDevProjectId:0,AppDevProjectName:"",AppDevProjectDescription:"",AppDevProjectVersion:"",FeedbackContent:"",Vendor:"",Platform:"",UserAgent:"",ScreenResolution:"",Rating:null,Files:[]},$scope.watgFileuploadConfig={Title:"Attachments",Files:[],MaxFileSize:5242880,MaxNumberOfFiles:5,AllowedFileExtensions:"png,jpg,doc,docx,pdf"},$scope.feedbackRichtextConfig={height:$scope.feedbackInputHeight,multiLine:!0,bootstrapCssPath:boostrapCssPath,showVariablesSelector:!0,showFontSelector:!0,showFontSizeSelector:!0,showColorSelector:!0,showBold:!0,showItalic:!0,showStrikeThrough:!0,showUnderline:!0,showUnorderedList:!0,showOrderedList:!0,showReduceIndent:!0,showIndent:!0,showLeftAlign:!0,showCenterAlign:!0,showRightAlign:!0,showJustify:!0,showUndo:!0,showRedo:!0,showInsertLink:!0,showRemoveLink:!0,showSourceCode:!1}},$scope.getAppDevProjectByProjectName=function(){$scope.isBusy=!0;var url=$scope.watgApiUrl+"/Feedback/GetAppDevProjectByProjectName/"+$scope.projectName;watgFeedbackService.getAppDevProjectByProjectName(url).then(function(result){if($scope.isBusy=!1,result&&void 0!==result.AppDevProjectId)$scope.projectNotFound=!1,$scope.appDevProjectUI.AppDevProjectId=result.AppDevProjectId,$scope.appDevProjectUI.AppDevProjectName=result.AppDevProjectName,$scope.appDevProjectUI.AppDevProjectDescription=result.AppDevProjectDescription,$scope.appDevProjectUI.AppDevProjectVersion=result.AppDevProjectVersion;else{$scope.projectNotFound=!0;var email={subject:"Application Feedback",body:"Users are unable to submit feedback for "+$scope.projectName+" because it was not found in AppDev.",recipients:[{Name:"App Dev",Email:"appdev@watg.com"}],fromEmail:"appdev@watg.com",fromName:"App Dev"};url=$scope.watgApiUrl+"/Common/SendEmailAPI",watgFeedbackService.sendEmail(email,url).then(function(result){result.HasError?(console.error("Failed sending AppDev notification emails"),console.error(result.Message)):console.info("AppDev Email sent successfully")})}})},$scope.submitAppDevProjectFeedback=function(){$scope.isBusySubmittingFeedback=!0,$scope.appDevProjectUI.Vendor=navigator.vendor,$scope.appDevProjectUI.Platform=navigator.platform,$scope.appDevProjectUI.UserAgent=navigator.userAgent,$scope.appDevProjectUI.ScreenResolution=window.screen.availWidth+"*"+window.screen.availHeight,$scope.appDevProjectUI.Rating=$scope.ratingValue,$scope.urlReferrer&&($scope.appDevProjectUI.FeedbackContent+="<br />(Previous page) "+$scope.urlReferrer),$scope.appDevProjectUI.Files=$scope.watgFileuploadConfig.Files;var url=$scope.watgApiUrl+"/Feedback/SubmitAppDevProjectFeedback";watgFeedbackService.submitAppDevProjectFeedback($scope.appDevProjectUI,url).then(function(result){var transactionResult=result;transactionResult.HasError===!0&&console.error("Feedback Error "+transactionResult.Message),$scope.showConfirmation=!0,$scope.isBusySubmittingFeedback=!1,$scope.reset()})},$scope.toggle=function(index){$scope.ratingValue=index+1},$scope.$watch("ratingValue",function(oldValue){oldValue&&updateStars()}),$scope.$watch("projectName",function(oldValue,newValue){null!==newValue&&""!==newValue&&void 0!==newValue&&$scope.getAppDevProjectByProjectName()}),$scope.$watch("appDevProjectUI.FeedbackContent",function(newValue){""===newValue||"<br>"===newValue?$scope.form.inputForm.$setValidity("message",!1):$scope.form.inputForm.$setValidity("message",!0)}),$scope.reset(),updateStars()}]}(),function(){"use strict";function watgFeedbackService($http){return{getAppDevProjectByProjectName:function(url){return $http({method:"GET",withCredentials:!0,url:url}).then(function(response){return response.data})},submitAppDevProjectFeedback:function(vm,url){console.log("Service 2 "+url);var formData=new FormData;formData.append("FeedbackContent",vm.FeedbackContent),formData.append("Vendor",vm.Vendor),formData.append("Platform",vm.Platform),formData.append("UserAgent",vm.UserAgent),formData.append("ScreenResolution",vm.ScreenResolution),formData.append("Rating",vm.Rating),formData.append("AppDevProjectId",vm.AppDevProjectId);for(var i=0;i<vm.Files.length;i++)formData.append("Files["+i+"]",vm.Files[i]);return $http({url:url,method:"POST",transformRequest:angular.identity,data:formData,withCredentials:!0,headers:{"Content-Type":void 0}}).then(function(response){return console.timeEnd("Posting Note"),response.data})},sendEmail:function(email,url){return console.log(email),$http({method:"POST",withCredentials:!0,url:url,data:email}).then(function(response){return response.data})}}}angular.module("watgFeedbackModule").factory("watgFeedbackService",["$http",watgFeedbackService])}();