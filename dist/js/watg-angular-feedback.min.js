/*! watg-angular-feedback 2015-08-05 */
var watgFeedbackModule=angular.module("watgFeedback",["watgFeedback.templates","watgRichtext"]).config(function($httpProvider){$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"]});watgFeedbackModule.directive("watgFeedback",function(watgFeedbackService){var controller=["$scope",function($scope){function updateStars(){$scope.stars=[];for(var i=0;i<$scope.max;i++)$scope.stars.push({filled:i<$scope.ratingValue})}$scope.header="Feedback",$scope.isBusySubmittingFeedback=!1,$scope.showConfirmation=!1,$scope.form={},$scope.feedbackItem={feedback:"",applicationId:0,applicationName:"",applicationDescription:"",applicationVersion:"",vendor:"",platform:"",userAgent:"",screenResolution:"",rating:null},$scope.max=5,$scope.stars=[],$scope.ratingValue=3,$scope.feebackContentResetCount=[],$scope.feedbackConfig={height:300,multiLine:!0,bootstrapCssPath:"public/css/vendor.min.css",showVariablesSelector:!0,showFontSelector:!0,showFontSizeSelector:!0,showColorSelector:!0,showBold:!0,showItalic:!0,showStrikeThrough:!0,showUnderline:!0,showUnorderedList:!0,showOrderedList:!0,showReduceIndent:!0,showIndent:!0,showLeftAlign:!0,showCenterAlign:!0,showRightAlign:!0,showJustify:!0,showUndo:!0,showRedo:!0,showInsertLink:!0,showRemoveLink:!0,showSourceCode:!1},$scope.getProjectDetails=function(){$scope.isBusy=!0,watgFeedbackService.getProjectDetails($scope.getUrl+"/"+$scope.projectName).then(function(result){$scope.feedbackItem.applicationId=result.Id,$scope.feedbackItem.applicationName=result.ProjectName,$scope.feedbackItem.applicationDescription=result.ProjectDescription,$scope.feedbackItem.applicationVersion=result.Version,$scope.isBusy=!1})},$scope.submitFeedback=function(){$scope.isBusySubmittingFeedback=!0,$scope.feedbackItem.vendor=navigator.vendor,$scope.feedbackItem.platform=navigator.platform,$scope.feedbackItem.userAgent=navigator.userAgent,$scope.feedbackItem.screenResolution=screen.width+"*"+screen.height,$scope.feedbackItem.rating=$scope.ratingValue,$scope.urlReferrer&&($scope.feedbackItem.feedback+="<br />(Previous page) "+$scope.urlReferrer),watgFeedbackService.addProjectFeedback($scope.feedbackItem,$scope.submitUrl).then(function(result){console.log(result);var transactionResult=result;transactionResult.HasError===!0&&consoloe.error("Feedback Error "+transactionResult.Message),$scope.showConfirmation=!0,$scope.isBusySubmittingFeedback=!1})},$scope.toggle=function(index){$scope.ratingValue=index+1},$scope.$watch("ratingValue",function(oldValue,newValue){newValue&&updateStars()}),$scope.$watch("projectName",function(oldValue,newValue){newValue&&$scope.getProjectDetails()}),$scope.$watch("feedbackItem.feedback",function(newValue,oldValue){""===newValue||"<br>"===newValue?$scope.form.inputForm.$setValidity("message",!1):$scope.form.inputForm.$setValidity("message",!0),console.log("rich text changed")}),$scope.getProjectDetails()}];return{restrict:"E",templateUrl:"app/templates/watgFeedbackTemplate.html",scope:{projectName:"=",getUrl:"=",submitUrl:"=",userFullName:"=",urlReferrer:"="},controller:controller,link:function(scope){console.log(scope.projectName),console.log(scope.getUrl),console.log(scope.submitUrl),console.log(scope.userFullName)}}}),watgFeedbackModule.factory("watgFeedbackService",function($http){return{getProjectDetails:function(url){return console.log(url),$http({method:"GET",withCredentials:!0,url:url}).then(function(response){return response.data})},addProjectFeedback:function(vm,url){return console.log(vm),console.log(url),$http({method:"POST",data:$.param(vm),withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:url}).then(function(response){return response.data})}}});